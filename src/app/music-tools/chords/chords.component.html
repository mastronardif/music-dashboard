<div class="chords-grid">
  <div class="chord" *ngFor="let c of chords">
    <div class="chord-header">{{ c.name }}</div>
    <svg [attr.width]="120" [attr.height]="160" viewBox="0 0 120 160" xmlns="http://www.w3.org/2000/svg">
      <g transform="translate(10,20)">
        <g *ngFor="let s of [0,1,2,3,4,5]; let i = index">
          <line [attr.x1]="i*18" y1="0" [attr.x2]="i*18" y2="80" stroke="#222" stroke-width="1" />
        </g>
        <g *ngFor="let f of [0,1,2,3,4]; let fi = index">
          <line x1="0" [attr.y1]="fi*20" x2="90" [attr.y2]="fi*20" stroke="#bbb" stroke-width="1" />
        </g>
        <rect x="-2" y="-6" width="94" height="6" fill="#111" *ngIf="getTopFret(c) <= 1 && !c.barre"></rect>
        <g *ngFor="let s of c.strings; let si = index">
          <text [attr.x]="si*18 - 5" y="-8" font-size="12" fill="#000">
            {{ s === 0 ? 'o' : (s === 'x' ? 'Ã—' : '') }}
          </text>
        </g>
        <g *ngFor="let s of c.strings; let si = index">
          <ng-container *ngIf="isNumber(s) && s > 0">
            <ng-container *ngIf="s as fret">
              <!-- Now fret is s, typed as number -->
              <circle [attr.cx]="si*18" [attr.cy]="getCircleYPosition(fret)" r="6" fill="#222"></circle>
              <text [attr.x]="si*18 - 3" [attr.y]="getCircleYPosition(fret) + 4" font-size="10" fill="#fff">
                {{ c.fingers && c.fingers[si] ? c.fingers[si] : '' }}
              </text>
            </ng-container>
          </ng-container>
        </g>
        <ng-container *ngIf="c.barre">
          <!-- simplified barre rendering -->
          <rect [attr.x]="-6" [attr.y]="(c.barre.fret - 0.6)*20" width="102" height="12" rx="6" fill="#222"
            opacity="0.95"></rect>
        </ng-container>
      </g>
    </svg>
  </div>
</div>
